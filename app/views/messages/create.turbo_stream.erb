<%= turbo_stream.append "messages",
      partial: "messages/message",
      locals: { message: @message } %>

<% if @assistant_msg %>
  <%= turbo_stream.append "messages",
        partial: "messages/message",
        locals: { message: @assistant_msg } %>
<% end %>

<%= turbo_stream.replace "message_form" do %>
  <%= render "messages/form", session: @session %>
<% end %>

<%= turbo_stream.after "messages" do %>
  <script>
    // Hard reset as fallback
    const input = document.querySelector('#message_content');
    if (input) input.value = "";

    // Auto focus back
    setTimeout(() => {
      const field = document.querySelector('#message_content');
      if (field) field.focus();
    }, 50);
  </script>
<% end %>
