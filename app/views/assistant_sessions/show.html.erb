<div class="container mt-4" data-controller="chat">
  <h2><%= @session.role %> Interview</h2>

  <p>Question <%= @session.current_question_number %> / 25</p>

  <p>
    ‚è≥ Time left:
    <span id="timer"><%= @time_left %></span> seconds
  </p>

  <hr>

  <div id="messages"
       data-chat-target="messages"
       style="min-height: 300px; max-height: 350px; overflow-y: scroll;">
    <%= render partial: "messages/message", collection: @messages %>
  </div>

  <% unless @session.completed? %>
    <div id="answer_form">
      <%= render partial: "messages/form", locals: { session: @session } %>
    </div>
  <% else %>
    <p class="mt-3">
      Interview completed.
      <%= link_to "View Final Report", report_assistant_session_path(@session), class: "btn btn-outline-primary" %>
    </p>
  <% end %>
</div>

<script>
  let t = <%= @time_left %>;
  setInterval(() => {
    if (t > 0) {
      t--;
      const el = document.getElementById("timer");
      if (el) el.textContent = t;
    }
  }, 1000);
</script>
